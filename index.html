<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC Digital Business Card Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-4 font-sans text-slate-900">

    <div id="app" class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md border border-slate-100">
        <h1 class="text-2xl font-black text-center mb-6 tracking-tight text-slate-800">NFC Business Card <span class="text-blue-600">Pro</span></h1>

        <div id="cardDisplay" class="hidden text-center">
            <div class="w-24 h-24 gradient-bg rounded-full mx-auto mb-4 flex items-center justify-center text-white text-3xl font-bold shadow-lg" id="initial"></div>
            <h2 id="displayName" class="text-2xl font-bold"></h2>
            <p id="displayPosition" class="text-blue-600 font-bold text-sm uppercase tracking-wider"></p>
            <p id="displayCompany" class="text-slate-500 mb-6 font-medium"></p>
            
            <div class="space-y-3">
                <a id="dialPhone" href="#" class="block w-full bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-slate-700 transition">Call / 撥打電話</a>
                <a id="openWeb" href="#" class="hidden block w-full bg-blue-50 text-blue-700 py-3 rounded-xl font-bold border border-blue-100">Website / 訪問網站</a>
                <a id="openMap" href="#" target="_blank" class="hidden block w-full bg-emerald-50 text-emerald-700 py-3 rounded-xl font-bold border border-emerald-100">Address / 查看地址</a>
                <button onclick="downloadVCard()" class="block w-full bg-white border-2 border-slate-800 text-slate-800 py-3 rounded-xl font-bold hover:bg-slate-50 transition">Add to Contacts / 加入通訊錄</button>
            </div>
            
            <hr class="my-8">
            <button onclick="window.location.href=window.location.pathname" class="text-sm text-slate-400 hover:text-blue-500 underline transition">Create Your Own / 建立我的名片</button>
        </div>

        <div id="inputForm" class="space-y-4">
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Name / 姓名 *</label>
                <input type="text" id="name" placeholder="John Doe" class="w-full border-slate-200 border-2 rounded-xl p-3 mt-1 focus:border-blue-500 outline-none">
            </div>

            <div>
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Position / 職位</label>
                <input type="text" id="position" placeholder="Manager / 經理" class="w-full border-slate-200 border-2 rounded-xl p-3 mt-1 focus:border-blue-500 outline-none transition">
            </div>
            
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Phone / 電話 *</label>
                <div class="flex mt-1">
                    <input list="countryCodes" id="countryCode" placeholder="+65" class="w-28 border-slate-200 border-2 border-r-0 rounded-l-xl p-3 bg-slate-50 text-sm outline-none focus:border-blue-500" oninput="smartCode(this)">
                    <datalist id="countryCodes">
                        <option value="+65">Singapore (SG)</option>
                        <option value="+60">Malaysia (MY)</option>
                        <option value="+91">India (IN)</option>
                        <option value="+886">Taiwan (TW)</option>
                        <option value="+86">China (CN)</option>
                        <option value="+852">Hong Kong (HK)</option>
                        <option value="+1">USA (US)</option>
                    </datalist>
                    <input type="tel" id="phone" placeholder="88888888" class="w-full border-slate-200 border-2 rounded-r-xl p-3 focus:border-blue-500 outline-none transition">
                </div>
            </div>

            <div>
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Company / 公司</label>
                <input type="text" id="company" placeholder="Global Asia Printing" class="w-full border-slate-200 border-2 rounded-xl p-3 mt-1 focus:border-blue-500 outline-none transition">
            </div>
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Website / 網站</label>
                <input type="url" id="web" placeholder="https://..." class="w-full border-slate-200 border-2 rounded-xl p-3 mt-1 focus:border-blue-500 outline-none transition">
            </div>
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Address / 地址</label>
                <textarea id="addr" placeholder="Office Address" class="w-full border-slate-200 border-2 rounded-xl p-3 mt-1 focus:border-blue-500 outline-none transition" rows="2"></textarea>
            </div>
            
            <button onclick="generateLink()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black text-lg shadow-xl mt-4">Generate NFC URL / 產生網址</button>

            <div id="result" class="hidden mt-6 p-5 bg-slate-900 rounded-2xl text-white text-center">
                <p class="text-xs font-bold text-slate-400 mb-2 uppercase text-center">Copy URL to NFC Tools / 拷貝網址</p>
                <textarea id="outputUrl" class="w-full text-xs border-none p-3 rounded-lg bg-slate-800 text-blue-300" rows="3" readonly></textarea>
                <button onclick="copyUrl()" class="w-full bg-blue-500 text-white py-2 rounded-lg mt-3 font-bold text-sm">Click to Copy / 點擊拷貝</button>
            </div>
        </div>
    </div>

    <script>
        function smartCode(input) {
            let val = input.value.trim();
            if (val.length >= 1 && !val.startsWith('+') && !isNaN(val.charAt(0))) {
                input.value = '+' + val;
            }
        }

        const params = new URLSearchParams(window.location.search);
        const n = params.get('n');
        const pos = params.get('pos');
        const p = params.get('p');
        const c = params.get('c');
        const w = params.get('w');
        const a = params.get('a');

        if (n && p) {
            document.getElementById('inputForm').classList.add('hidden');
            document.getElementById('cardDisplay').classList.remove('hidden');
            document.getElementById('displayName').innerText = n;
            document.getElementById('displayPosition').innerText = pos || '';
            document.getElementById('displayCompany').innerText = c || '';
            document.getElementById('initial').innerText = n.charAt(0);
            document.getElementById('dialPhone').href = `tel:${p}`;
            if(w) { document.getElementById('openWeb').classList.remove('hidden'); document.getElementById('openWeb').href = w.startsWith('http') ? w : `https://${w}`; }
            if(a) { document.getElementById('openMap').classList.remove('hidden'); document.getElementById('openMap').href = `google.com/maps/search/` + encodeURIComponent(a); }
        }

        function generateLink() {
            const nameVal = document.getElementById('name').value;
            const pVal = document.getElementById('phone').value;
            if(!nameVal || !pVal) return alert('請填寫姓名與電話');
            
            let code = document.getElementById('countryCode').value || '+65';
            if (!code.startsWith('+')) code = '+' + code;
            const fullPhone = code + pVal.replace(/\s+/g, '');

            const baseUrl = window.location.href.split('?')[0];
            const finalUrl = `${baseUrl}?n=${encodeURIComponent(nameVal)}&pos=${encodeURIComponent(document.getElementById('position').value)}&p=${encodeURIComponent(fullPhone)}&c=${encodeURIComponent(document.getElementById('company').value)}&w=${encodeURIComponent(document.getElementById('web').value)}&a=${encodeURIComponent(document.getElementById('addr').value)}`;
            
            document.getElementById('outputUrl').value = finalUrl;
            document.getElementById('result').classList.remove('hidden');
        }

        function copyUrl() {
            document.getElementById("outputUrl").select();
            document.execCommand("copy");
            alert("URL Copied!");
        }

        function downloadVCard() {
            // 強制將姓名填入 vCard 的第一個欄位，並將公司名稱移後
            const vcard = [
                'BEGIN:VCARD',
                'VERSION:3.0',
                `FN:${n}`,
                `N:${n};;;;`,
                `ORG:${c}`,
                `TITLE:${pos}`,
                `TEL;TYPE=CELL,VOICE:${p}`,
                `URL;TYPE=WORK:${w}`,
                `ADR;TYPE=WORK:;;${a};;;;`,
                'END:VCARD'
            ].join('\n');

            const blob = new Blob([vcard], { type: 'text/vcard;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const aLink = document.createElement('a');
            aLink.href = url;
            aLink.download = `${n.replace(/\s+/g, '_')}.vcf`;
            aLink.click();
        }
    </script>
</body>
</html>
